-- Criando o Banco:
CREATE DATABASE BdUniversidade;

-- Criando Tabela Alunos:
CREATE TABLE Alunos(
	MAT int NOT NULL,
	Nome VARCHAR(100) NOT NULL,
	Endereco VARCHAR(100) NOT NULL,
	Cidade VARCHAR (50) NOT NULL,
	PRIMARY KEY(MAT)
)

--Criando a Tabela Professores:
CREATE TABLE Disciplinas (
	COD_DISC VARCHAR(10) NOT NULL,
	Nome_disc VARCHAR(100) NOT NULL, 
	Carga_hor int NOT NULL,
	PRIMARY KEY(COD_DISC)
)

--Criando a Tabela Professores:
CREATE TABLE Professores (
	COD_PROF INT NOT NULL, 
	Nome VARCHAR(100) NOT NULL,
	Endereco VARCHAR(100) NOT NULL, 
	Cidade VARCHAR (50) NOT NULL,
	PRIMARY KEY(COD_PROF)
)

-- Criando Tabela Turma e referenciando:
CREATE TABLE Turma (
	COD_DISC VARCHAR(10) NOT NULL, 
	COD_TURMA VARCHAR(10) NOT NULL, 
	COD_PROF int NOT NULL,  
	horario VARCHAR(10) NOT NULL,
	PRIMARY KEY(COD_TURMA)
)

ALTER TABLE Turma
ADD FOREIGN KEY (COD_DISC) REFERENCES Disciplinas(COD_DISC);

ALTER TABLE Turma
ADD FOREIGN KEY (COD_PROF) REFERENCES Professores(COD_PROF);

-- Criando Tabela Historico e referenciando::
CREATE TABLE Historico (
	MAT int NOT NULL, 
	COD_DISC VARCHAR(10) NOT NULL, 
	COD_TURMA VARCHAR(10) NOT NULL, 
	COD_PROF int NOT NULL, 
	Frequência int NOT NULL, 
	Nota int NOT NULL
)
ALTER TABLE Historico
ADD FOREIGN KEY (MAT) REFERENCES Alunos(MAT);

ALTER TABLE Historico
ADD FOREIGN KEY (COD_DISC) REFERENCES Disciplinas(COD_DISC);

ALTER TABLE Historico
ADD FOREIGN KEY (COD_PROF) REFERENCES Professores(COD_PROF);

ALTER TABLE Historico
ADD FOREIGN KEY (COD_TURMA) REFERENCES Turma(COD_TURMA);

-- Inserção dos Alunos:
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010101, 'JOSE DE ALENCAR', 'RUA DAS ALMAS', 'NATAL');
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010102, 'JOÃO JOSÉ', 'AVENIDA RUY CARNEIRO', 'JOÃO PESSOA');
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010103, 'MARIA JOAQUINA', 'RUA CARROSSEL', 'RECIFE');
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010104, 'MARIA DAS DORES', 'RUA DAS LADEIRAS', 'FORTALEZA');
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010105, 'JOSUÉ CLAUDINO DOS SANTOS', 'CENTRO', 'NATAL');
INSERT INTO Alunos (MAT,Nome,Endereco, Cidade) VALUES (2015010106, 'JOSUÉLISSON CLAUDINO DOS SANTOS', 'CENTRO', 'NATAL');

-- Inserção de Disciplinas:
--BD = B, POO = P, WEB = W, ENG = E
INSERT INTO Disciplinas(COD_DISC, Nome_disc, Carga_hor) VALUES ('B', 'BANCO DE DADOS', 100 );
INSERT INTO Disciplinas(COD_DISC, Nome_disc, Carga_hor) VALUES ('P', 'PROGRAMAÇÃO COM ACESSO A BANCO DE DADOS', 100 );
INSERT INTO Disciplinas(COD_DISC, Nome_disc, Carga_hor) VALUES ('W', 'AUTORIA WEB', 50);
INSERT INTO Disciplinas(COD_DISC, Nome_disc, Carga_hor) VALUES ('E', 'ENGENHARIA DE SOFTWARE', 80);

-- Inserção de Professores:
-- 212131 = 1; 122135 = 2; 192011 = 3;
INSERT INTO Professores(COD_PROF, Nome, Endereco, Cidade) VALUES ( 212131, 'NICKERSON FERREIRA', 'RUA MANAÍRA', 'JOÃO PESSOA');
INSERT INTO Professores(COD_PROF, Nome, Endereco, Cidade) VALUES ( 122135, 'ADORILSON BEZERRA', 'AVENIDA SALGADO FILHO', 'NATAL');
INSERT INTO Professores(COD_PROF, Nome, Endereco, Cidade) VALUES (192011, 'DIEGO OLIVEIRA', 'AVENIDA ROBERTO FREIRE', 'NATAL');

-- Inserção da turma:
INSERT INTO Turma(COD_DISC, COD_TURMA, COD_PROF, horario) VALUES ('B','BD1-2015', 212131, '11H-12H');
INSERT INTO Turma(COD_DISC, COD_TURMA, COD_PROF, horario) VALUES ('B', 'BD2-2015', 212131, '13H-14H');
INSERT INTO Turma(COD_DISC, COD_TURMA, COD_PROF, horario) VALUES ('P', 'POO-2015', 192011, '08H-09H');
INSERT INTO Turma(COD_DISC, COD_TURMA, COD_PROF, horario) VALUES ('W', 'WEB-2015', 192011, '07H-08H');
INSERT INTO Turma(COD_DISC, COD_TURMA, COD_PROF, horario) VALUES ('E', 'ENG-2015', 122135, '10H-11H');

-- Inserção em Historico:
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010101,'B','BD1-2015',212131, 100, 10 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010101,'P','POO-2015',192011, 70, 8);
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010101,'W', 'WEB-2015', 192011, 90, 7 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010101,'E', 'ENG-2015', 122135, 100, 9 );

INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010102,'B','BD2-2015',212131, 80, 9 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010102,'P','POO-2015',192011, 100, 8 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010102,'W', 'WEB-2015', 192011, 90, 7 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010102,'E', 'ENG-2015', 122135, 80, 10 );

INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010103,'B','BD2-2015',212131, 70, 9 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010103,'P','POO-2015',192011, 90, 5 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010103,'W', 'WEB-2015', 192011, 90, 9);
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010103,'E', 'ENG-2015', 122135, 80, 4 );

INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010104,'B','BD1-2015',212131, 70, 4 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010104,'P','POO-2015',192011, 40, 8 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010104,'W', 'WEB-2015', 192011, 100, 8);
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010104,'E', 'ENG-2015', 122135, 80, 9 );

INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010105,'B','BD2-2015',212131, 10, 0 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010105,'P','POO-2015',192011, 100, 8 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010105,'W', 'WEB-2015', 192011, 80, 6);
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010105,'E', 'ENG-2015', 122135, 100, 9 );

INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010106,'B','BD1-2015',212131, 100, 3 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010106,'P','POO-2015',192011, 60, 9 );
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010106,'W', 'WEB-2015', 192011, 70, 7);
INSERT INTO Historico(MAT, COD_DISC,COD_TURMA, COD_PROF,Frequência, Nota) VALUES (2015010106,'E', 'ENG-2015', 122135, 90, 8 );

-- Consultas: 

-- 1: Encontre a MAT dos alunos com nota em BD em 2015 menor que 5 (obs: BD = código da disciplinas).
SELECT MAT
FROM Historico
WHERE COD_DISC = 'B' and Nota<5;

-- 2: Encontre a MAT e calcule a média das notas dos alunos na disciplina de POO em 2015.
SELECT MAT 
FROM Historico
WHERE COD_DISC = 'P'

SELECT AVG(Nota) as Médias_das_Notas
FROM Historico
WHERE COD_DISC = 'P'


-- 3: Encontre a MAT e calcule a média das notas dos alunos na disciplina de POO em 2015 e que esta média seja superior a 6.
SELECT MAT 
FROM Historico
WHERE COD_DISC = 'P'

SELECT AVG(Nota) as Médias_das_Notas_Maior_Que_6
FROM Historico
WHERE COD_DISC = 'P'

-- 4: Encontre quantos alunos não são de Natal.
SELECT count(*)
FROM Alunos
WHERE Cidade = 'Natal'